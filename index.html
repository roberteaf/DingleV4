<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roblox MVP – Build & Play</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(to bottom, #f9fafb, #eef2f7);
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      text-align: center;
      padding: 1em;
    }
    .subtitle {
      color: #666;
      font-size: 0.9em;
    }
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1em;
    }
    #ui {
      background: white;
      border-radius: 12px;
      padding: 10px 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .controls button {
      margin-right: 5px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .controls button:hover {
      background: #2563eb;
    }
    canvas {
      border: 1px solid #ccc;
      border-radius: 8px;
      image-rendering: pixelated;
      background: #eef2f7;
    }
    #auth {
      margin-top: 1em;
    }
    #auth input {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #auth button {
      margin-left: 5px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
    }
    footer {
      text-align: center;
      font-size: 0.8em;
      color: #555;
      margin-top: 2em;
    }
  </style>
</head>
<body>
  <header>
    <h1>Roblox MVP – Build & Play</h1>
    <p class="subtitle">
      A minimal demo of the Roblox-style <strong>create → share → play</strong> loop.
    </p>
  </header>

  <main>
    <section id="ui">
      <div class="controls">
        <button id="toggleMode">Switch to Play</button>
        <button id="resetBtn">Reset Level</button>
        <button id="exportBtn">Export Level</button>
        <input type="file" id="importFile" accept="application/json" />
      </div>
      <div class="info">
        <span id="modeLabel">Mode: EDIT</span>
        <span id="playerLabel">Player: (0, 0)</span>
      </div>
    </section>

    <canvas id="gameCanvas" width="640" height="360"></canvas>

    <section id="auth">
      <input id="username" placeholder="Enter name..." />
      <button id="loginBtn">Join</button>
    </section>
  </main>

  <footer>
    <p>
      Built as a <strong>Minimum Viable Product</strong> demonstration — edit and play your own 2D world.
      <br />
      Movement: <code>← → ↑</code> or <code>A D W</code> | Space to jump
    </p>
  </footer>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gridSize = 20;
    const cols = canvas.width / gridSize;
    const rows = canvas.height / gridSize;

    let mode = 'edit';
    let blocks = createGrid(cols, rows);
    let player = { x: 80, y: 80, vx: 0, vy: 0, w: 18, h: 32 };
    let keys = {};
    let username = 'Guest';
    let others = {}; // placeholder for multiplayer later

    // ----- AUTH -----
    document.getElementById('loginBtn').onclick = () => {
      const name = document.getElementById('username').value.trim();
      if (name) username = name;
      alert(`Welcome, ${username}!`);
    };

    // ----- UI -----
    const modeLabel = document.getElementById('modeLabel');
    document.getElementById('toggleMode').onclick = () => {
      mode = mode === 'edit' ? 'play' : 'edit';
      modeLabel.textContent = \`Mode: \${mode.toUpperCase()}\`;
      document.getElementById('toggleMode').innerText =
        mode === 'edit' ? 'Switch to Play' : 'Switch to Edit';
    };

    document.getElementById('resetBtn').onclick = () => {
      blocks = createGrid(cols, rows);
    };

    document.getElementById('exportBtn').onclick = () => {
      const data = JSON.stringify({ blocks });
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'level.json';
      a.click();
      URL.revokeObjectURL(url);
    };

    document.getElementById('importFile').onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        try {
          const obj = JSON.parse(ev.target.result);
          if (obj.blocks) blocks = obj.blocks;
        } catch {
          alert('Invalid level file.');
        }
      };
      reader.readAsText(file);
    };

    // ----- INPUT -----
    window.addEventListener('keydown', e => (keys[e.code] = true));
    window.addEventListener('keyup', e => (keys[e.code] = false));
    canvas.addEventListener('click', e => {
      if (mode !== 'edit') return;
      const rect = canvas.getBoundingClientRect();
      const cx = Math.floor((e.clientX - rect.left) / gridSize);
      const cy = Math.floor((e.clientY - rect.top) / gridSize);
      blocks[cy][cx] = !blocks[cy][cx];
    });

    // ----- GAME LOOP -----
    let last = performance.now();
    function loop(t) {
      const dt = (t - last) / 1000;
      last = t;
      update(dt);
      draw();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // ----- UPDATE -----
    function update(dt) {
      if (mode === 'play') {
        player.vy += 900 * dt;
        player.x += player.vx * dt;
        player.y += player.vy * dt;

        if (keys['ArrowLeft'] || keys['KeyA']) player.vx = -120;
        else if (keys['ArrowRight'] || keys['KeyD']) player.vx = 120;
        else player.vx = 0;

        // collision / ground
        if (player.y + player.h > canvas.height) {
          player.y = canvas.height - player.h;
          player.vy = 0;
        }

        // jump
        if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.vy === 0)
          player.vy = -320;
      }
    }

    // ----- DRAW -----
    function draw() {
      ctx.fillStyle = '#eef2f7';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          if (blocks[y][x]) {
            ctx.fillStyle = '#93c5fd';
            ctx.fillRect(x * gridSize, y * gridSize, gridSize, gridSize);
            ctx.strokeStyle = '#bfdbfe';
            ctx.strokeRect(x * gridSize, y * gridSize, gridSize, gridSize);
          }
        }
      }

      ctx.fillStyle = '#f87171';
      ctx.fillRect(player.x, player.y, player.w, player.h);
      ctx.fillStyle = 'white';
      ctx.fillRect(player.x + 4, player.y + 6, 4, 4);

      ctx.fillStyle = '#111';
      ctx.font = '12px sans-serif';
      ctx.fillText(\`Mode: \${mode}\`, 10, 15);
      ctx.fillText(\`Player: \${username}\`, 10, 30);
    }

    function createGrid(cols, rows) {
      const grid = [];
      for (let y = 0; y < rows; y++) {
        grid.push(new Array(cols).fill(y === rows - 1)); // floor
      }
      return grid;
    }
  </script>
</body>
</html>
