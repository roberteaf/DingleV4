<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Gamble Hub 🎮💎</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #000000 0%, #001f3f 50%, #7b2cbf 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body.logged-in .screen {
            left: 300px;
            width: calc(100% - 300px);
        }
        
        body:not(.logged-in) .screen {
            left: 0;
            width: 100%;
        }
        
        .chat-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 300px;
            height: 100vh;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(123, 44, 191, 0.2));
            backdrop-filter: blur(10px);
            z-index: 5;
            display: none;
            flex-direction: column;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.5);
        }
        
        body.logged-in .chat-sidebar {
            display: flex;
        }
        
        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .message {
            padding: 10px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            word-wrap: break-word;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .message small {
            opacity: 0.7;
            font-size: 0.8em;
            display: block;
            margin-bottom: 5px;
        }
        
        #chat-input-container {
            padding: 15px;
            border-top: 1px solid rgba(123, 44, 191, 0.3);
            display: flex;
            gap: 10px;
        }
        
        #chat-input {
            flex: 1;
            padding: 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(123, 44, 191, 0.3);
            color: #fff;
            font-family: 'Roboto', sans-serif;
        }
        
        #chat-input:focus {
            outline: none;
            box-shadow: 0 0 10px #7b2cbf;
        }
        
        .screen {
            position: absolute;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: opacity 0.5s ease-in-out;
            z-index: 1;
        }
        
        .hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .header {
            width: 100%;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(123, 44, 191, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
            position: relative;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header-left h1 {
            font-size: 1.8em;
            text-shadow: 0 0 10px #7b2cbf;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px #7b2cbf; }
            to { text-shadow: 0 0 20px #7b2cbf, 0 0 30px #7b2cbf; }
        }
        
        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }
        
        .balance {
            font-size: 1.3em;
            padding: 8px 15px;
            background: linear-gradient(145deg, rgba(0, 31, 63, 0.9), rgba(123, 44, 191, 0.3));
            border-radius: 20px;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(123, 44, 191, 0.4);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            font-family: 'Roboto', sans-serif;
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(123, 44, 191, 0.3));
            color: #ffffff;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(123, 44, 191, 0.5);
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(123, 44, 191, 0.4));
        }
        
        .logout {
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.3), rgba(123, 44, 191, 0.2)) !important;
        }
        
        .logout:hover {
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.5), rgba(123, 44, 191, 0.3)) !important;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }
        
        .game-card {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.6), rgba(123, 44, 191, 0.2));
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .game-card:hover::before {
            left: 100%;
        }
        
        .game-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: #7b2cbf;
            box-shadow: 0 12px 40px rgba(123, 44, 191, 0.6);
        }
        
        .game-icon {
            font-size: 4em;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(123, 44, 191, 0.5));
            transition: transform 0.3s ease;
        }
        
        .game-card:hover .game-icon {
            transform: scale(1.2);
        }
        
        .game-title {
            font-size: 1.4em;
            font-weight: 700;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .coming-soon {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .coming-soon:hover {
            transform: none;
            border-color: transparent;
            box-shadow: none;
        }
        
        .game-area {
            width: 100%;
            max-width: 800px;
            padding: 40px;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.7), rgba(123, 44, 191, 0.1));
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.6s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .back-btn {
            align-self: flex-start;
            background: linear-gradient(145deg, rgba(123, 44, 191, 0.3), rgba(0, 0, 0, 0.5));
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        input, select {
            padding: 12px 18px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(123, 44, 191, 0.3);
            color: #fff;
            font-size: 1em;
            min-width: 80px;
        }
        
        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 15px #7b2cbf;
            border-color: #7b2cbf;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .controls button {
            padding: 12px 20px;
            font-size: 1em;
            border-radius: 15px;
            background: linear-gradient(145deg, rgba(0, 255, 0, 0.2), rgba(123, 44, 191, 0.3));
        }
        
        .result {
            font-size: 1.2em;
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            min-height: 20px;
        }
        
        .mine-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 20px 0;
        }
        
        .mine-cell {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(123, 44, 191, 0.2));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .mine-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(123, 44, 191, 0.5);
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(123, 44, 191, 0.3));
        }
        
        .mine-cell.boom {
            background: linear-gradient(145deg, #ff0000, #cc0000);
            animation: explode 0.5s ease;
            transform: scale(1.2);
        }
        
        .mine-cell.disabled {
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @keyframes explode {
            0% { transform: scale(1); }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .dice-display {
            font-size: 4em;
            margin: 20px 0;
            text-shadow: 0 0 10px #ffff00;
        }
        
        .tower-display {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 20px 0;
        }
        
        .tower-row {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .tower-cell {
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(123, 44, 191, 0.2));
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .tower-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(123, 44, 191, 0.5);
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(123, 44, 191, 0.3));
        }
        
        .tower-cell.revealed {
            pointer-events: none;
        }
        
        .tower-cell.safe {
            background: linear-gradient(145deg, #00ff00, #00cc00);
        }
        
        .tower-cell.skull {
            background: linear-gradient(145deg, #ff0000, #cc0000);
            animation: explode 0.5s ease;
        }
        
        .card-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .card {
            display: inline-block;
            background: linear-gradient(145deg, #001f3f, #7b2cbf);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2em;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: flip 0.6s ease;
            min-width: 50px;
            text-align: center;
        }
        
        @keyframes flip {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0); }
        }
        
        #crash-area {
            position: relative;
            height: 400px;
            width: 100%;
            background: linear-gradient(to top, #001f3f, #000);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #rocket {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            transition: transform 0.1s ease-out;
            z-index: 2;
        }
        
        #multiplier {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            z-index: 2;
        }

        #countdown {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
            z-index: 2;
        }
        
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 15px 20px;
            background: rgba(0, 31, 63, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(123, 44, 191, 0.5);
            animation: slideInRight 0.5s ease-out;
            z-index: 1000;
            border-left: 4px solid #7b2cbf;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .coming-soon-content {
            text-align: center;
            font-size: 1.5em;
            opacity: 0.7;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(123, 44, 191, 0.3);
        }

        th {
            background: rgba(123, 44, 191, 0.2);
            font-weight: bold;
        }

        #cashout-btn, #cashout-btn-towers, #cashout-btn-crash {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.3), rgba(123, 44, 191, 0.3)) !important;
            padding: 12px 24px;
            font-size: 1em;
        }

        #cashout-btn:hover, #cashout-btn-towers:hover, #cashout-btn-crash:hover {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.5), rgba(123, 44, 191, 0.4)) !important;
        }
    </style>
</head>
<body>
    <div id="chat-sidebar" class="chat-sidebar">
        <div id="messages"></div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
    
    <div id="login" class="screen visible">
        <div class="main-content">
            <div style="text-align: center; max-width: 400px;">
                <h1 style="font-size: 3em; margin-bottom: 30px;">Minecraft Gamble Hub 🎮💎</h1>
                <input type="text" id="username" placeholder="Enter Username 👤" maxlength="20" style="width: 100%; margin-bottom: 15px;">
                <select id="edition" style="width: 100%; margin-bottom: 20px;">
                    <option value="Bedrock">Bedrock Edition 🛏️</option>
                    <option value="Java">Java Edition ☕</option>
                </select>
                <button class="btn" onclick="login()" style="width: 100%; padding: 15px; font-size: 1.2em;">Login & Play 🎯</button>
                <p style="margin-top: 20px; opacity: 0.7; font-family: 'Roboto', sans-serif;">Powered by Pixels & Bets ✨</p>
            </div>
        </div>
    </div>
    
    <div id="dashboard" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <h1>Welcome, <span id="user"></span> (<span id="ed"></span>) 💎</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="games-grid">
                <div class="game-card" onclick="showScreen('mines')">
                    <div class="game-icon">💎💣</div>
                    <h3 class="game-title">Mines</h3>
                </div>
                <div class="game-card" onclick="showScreen('dice')">
                    <div class="game-icon">🎲🎲</div>
                    <h3 class="game-title">Dice</h3>
                </div>
                <div class="game-card" onclick="showScreen('towers')">
                    <div class="game-icon">🏗️</div>
                    <h3 class="game-title">Towers</h3>
                </div>
                <div class="game-card" onclick="showScreen('blackjack')">
                    <div class="game-icon">🃏</div>
                    <h3 class="game-title">Blackjack</h3>
                </div>
                <div class="game-card" onclick="showScreen('crash')">
                    <div class="game-icon">🚀</div>
                    <h3 class="game-title">Crash</h3>
                </div>
                <div class="game-card coming-soon" onclick="showComingSoon()">
                    <div class="game-icon">⏳</div>
                    <h3 class="game-title">Coming Soon</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="admin" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Admin Dashboard 🔧</h1>
            </div>
            <div class="header-right">
                <div class="balance">Admin Mode Active 👑</div>
                <div class="header-buttons">
                    <button class="btn" onclick="downloadLog()">📥 Download Log</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div style="max-width: 800px; width: 100%;">
                <h2 style="text-align: center; margin-bottom: 20px;">User Management</h2>
                <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <input type="text" id="userSearch" placeholder="Search users..." style="width: 300px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #7b2cbf; color: white;">
                    <button class="btn" onclick="loadUsers('')">Refresh 🔄</button>
                </div>
                <div id="usersTable" style="overflow-y: auto; max-height: 400px; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 10px;"></div>
                <div style="margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 15px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 10px;">
                    <h3 style="margin: 0; flex-basis: 100%; text-align: center;">Adjust Balance for User</h3>
                    <input type="text" id="selectedUser" placeholder="Enter Username (e.g. NewUser)" style="width: 200px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #7b2cbf; color: white;">
                    <input type="text" id="adjustAmount" placeholder="Amount (e.g. 100k)" style="width: 150px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #7b2cbf; color: white;">
                    <button class="btn" onclick="doDeposit()" style="background: linear-gradient(145deg, rgba(0,255,0,0.3), rgba(0,200,0,0.2));">Deposit 💳</button>
                    <button class="btn" onclick="doWithdraw()" style="background: linear-gradient(145deg, rgba(255,0,0,0.3), rgba(200,0,0,0.2));">Withdraw 🏦</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="mines-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Mines 💣</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-mines">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="minesbet" placeholder="10 or 1k" value="10">
                    <label>Mines:</label>
                    <select id="minesnum">
                        <option>1</option>
                        <option>3</option>
                        <option>5</option>
                    </select>
                    <button class="btn" onclick="startMines()">Start 🔍</button>
                </div>
                <div id="mine-grid" class="mine-grid"></div>
                <button id="cashout-btn" class="btn" onclick="cashOutMines()" style="display: none;">Cash Out 💰</button>
                <div id="mines-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="dice-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Dice 🎲</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-dice">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="dicebet" placeholder="10 or 1k" value="10">
                    <select id="dicechoice">
                        <option value="over">Over 7 (Win if >7)</option>
                        <option value="under">Under 7 (Win if <7)</option>
                    </select>
                    <button class="btn" onclick="playDice()">Roll 🎲</button>
                </div>
                <div id="dice-display" class="dice-display"></div>
                <div id="dice-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="towers-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Towers 🏗️</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-towers">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="towersbet" placeholder="10 or 1k" value="10">
                    <button class="btn" onclick="startTowers()">Build & Climb 🧗</button>
                </div>
                <div id="towers-display" class="tower-display"></div>
                <button id="cashout-btn-towers" class="btn" onclick="cashOutTowers()" style="display: none;">Cash Out 💰</button>
                <div id="towers-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="blackjack-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Blackjack 🃏</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-blackjack">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="bet" placeholder="10 or 1k" value="10">
                    <button class="btn" onclick="playBlackjack()">Deal Cards 🎴</button>
                </div>
                <div id="bj-hand-player" class="card-display"></div>
                <div style="text-align: center; margin: 10px 0;">vs</div>
                <div id="bj-hand-dealer" class="card-display"></div>
                <div class="controls">
                    <button class="btn" onclick="bjHit()">Hit ➡️</button>
                    <button class="btn" onclick="bjStand()">Stand 🛑</button>
                </div>
                <div id="bj-result" class="result"></div>
            </div>
        </div>
    </div>

    <div id="crash-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Crash 🚀</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-crash">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group" id="crash-input">
                    <label>Bet: $</label>
                    <input type="text" id="crashbet" placeholder="10 or 1k" value="10">
                    <button class="btn" onclick="betOnCrash()">Bet 🚀</button>
                </div>
                <div id="crash-area" style="display: none;">
                    <div id="countdown"></div>
                    <div id="rocket">🚀</div>
                    <div id="multiplier">1.00x</div>
                </div>
                <button id="cashout-btn-crash" class="btn" onclick="cashOutCrash()" style="display: none;">Cash Out 💰</button>
                <div id="crash-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="notification"></div>

    <script>
        let currentUser = '';
        let currentEdition = '';
        let balance = 0.00;
        let currentScreen = 'login';
        let isAdmin = false;
        
        // Game state variables
        let playerHand = [], dealerHand = [], bjBet = 0;
        let minesGrid = [], minesNum = 0, minesRevealed = 0, minesBet = 0, gameActive = false;
        let diceBet = 0;
        let towersHeight = 0, towersBet = 0;
        let towersGrid = [], currentTowerRow = 0, towersRevealed = 0, towersGameActive = false;
        let users = [];
        
        // Crash global state
        let globalCrashActive = false;
        let globalBettingActive = false;
        let globalStartTime;
        let globalLaunchTime;
        let globalCrashMultiplier;
        let globalCurrentMultiplier = 1.00;
        let userCrashBet = 0;
        let userCashedOut = false;
        
        // Chat state
        let messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
        
        // Initialize transaction log if not exists
        if (!localStorage.getItem('transactionLog')) {
            localStorage.setItem('transactionLog', JSON.stringify([]));
        }
        
        function logTransaction(type, data) {
            const log = JSON.parse(localStorage.getItem('transactionLog') || '[]');
            log.push({
                type,
                timestamp: new Date().toISOString(),
                ...data
            });
            localStorage.setItem('transactionLog', JSON.stringify(log));
        }
        
        function downloadLog() {
            const log = JSON.parse(localStorage.getItem('transactionLog') || '[]');
            const dataStr = JSON.stringify(log, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `transaction_log_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function formatBalance(bal) {
            if (bal >= 1e9) return (bal / 1e9).toFixed(1) + 'B';
            if (bal >= 1e6) return (bal / 1e6).toFixed(1) + 'M';
            if (bal >= 1e3) return (bal / 1e3).toFixed(1) + 'K';
            return bal.toFixed(2);
        }

        function parseBet(str) {
            str = str.toLowerCase().trim();
            let num = parseFloat(str);
            if (isNaN(num)) num = 0;
            if (str.includes('k')) num *= 1000;
            else if (str.includes('m')) num *= 1e6;
            else if (str.includes('b')) num *= 1e9;
            return num;
        }

        function computeMinesMultiplier(revealed, mines) {
            const total = 25;
            const safe = total - mines;
            if (revealed === 0) return 1.0;
            let prob = 1.0;
            for (let i = 0; i < revealed; i++) {
                prob *= (safe - i) / (total - i);
            }
            return 1.0 / prob;
        }
        
        function loadMessages() {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            messages.forEach(msgObj => {
                const div = document.createElement('div');
                div.className = 'message';
                div.innerHTML = `<small>${new Date(msgObj.time).toLocaleTimeString()}</small><br>${msgObj.text}`;
                messagesDiv.appendChild(div);
            });
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            const msgObj = { text, time: Date.now() };
            messages.push(msgObj);
            localStorage.setItem('chatMessages', JSON.stringify(messages));
            input.value = '';
            loadMessages();
        }
        
        // Load from localStorage
        function loadData() {
            currentUser = localStorage.getItem('username') || '';
            currentEdition = currentUser ? localStorage.getItem(`${currentUser}_edition`) || 'Bedrock' : 'Bedrock';
            balance = currentUser ? parseFloat(localStorage.getItem(`${currentUser}_balance`)) || 0 : 0;
            isAdmin = currentUser === 'Zh3eOnDiscord2025' && currentEdition === 'Java';
            if (currentUser) {
                document.body.classList.add('logged-in');
                showScreen('dashboard');
                updateAllBalances();
                loadMessages();
                addAdminButton();
            }
        }
        
        function addAdminButton() {
            if (!isAdmin) return;
            const headerButtons = document.querySelector('#dashboard .header-buttons');
            if (headerButtons.querySelector('.admin-btn')) return;
            const adminBtn = document.createElement('button');
            adminBtn.className = 'btn admin-btn';
            adminBtn.textContent = 'Admin Panel 🔧';
            adminBtn.onclick = () => showScreen('admin');
            headerButtons.insertBefore(adminBtn, headerButtons.firstChild);
        }
        
        function updateAllBalances() {
            const formatted = formatBalance(balance);
            ['balance', 'balance-mines', 'balance-dice', 'balance-towers', 'balance-blackjack', 'balance-crash'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = formatted;
            });
        }
        
        function showScreen(screen) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('visible');
                s.classList.add('hidden');
            });
            // Show target screen
            const target = document.getElementById(`${screen}-screen`) || document.getElementById(screen);
            if (target) {
                target.classList.remove('hidden');
                target.classList.add('visible');
                currentScreen = screen;
                if (screen !== 'login') {
                    updateAllBalances();
                    loadMessages();
                }
                if (screen === 'admin') {
                    loadUsers('');
                }
                if (screen === 'mines') {
                    resetMines();
                }
                if (screen === 'towers') {
                    resetTowers();
                }
                if (screen === 'blackjack') {
                    resetBlackjack();
                }
                if (screen === 'crash') {
                    resetCrash();
                    if (!globalBettingActive && !globalCrashActive) {
                        startBettingPhase();
                    }
                }
            }
        }

        function resetBlackjack() {
            playerHand = [];
            dealerHand = [];
            bjBet = 0;
            document.getElementById('bj-hand-player').innerHTML = '';
            document.getElementById('bj-hand-dealer').innerHTML = '';
            document.getElementById('bj-result').textContent = '';
            document.querySelectorAll('#blackjack-screen .controls button').forEach(btn => btn.disabled = false);
        }

        function resetMines() {
            gameActive = false;
            minesRevealed = 0;
            document.getElementById('cashout-btn').style.display = 'none';
            document.getElementById('mine-grid').innerHTML = '';
            document.getElementById('mines-result').textContent = '';
        }

        function resetTowers() {
            towersGameActive = false;
            currentTowerRow = 0;
            towersRevealed = 0;
            document.getElementById('cashout-btn-towers').style.display = 'none';
            document.getElementById('towers-display').innerHTML = '';
            document.getElementById('towers-result').textContent = '';
        }

        function resetCrash() {
            const inputGroup = document.getElementById('crash-input');
            if (inputGroup) inputGroup.style.display = 'flex';
            document.getElementById('crash-area').style.display = 'block';
            document.getElementById('cashout-btn-crash').style.display = 'none';
            document.getElementById('crash-result').textContent = '';
            const rocket = document.getElementById('rocket');
            if (rocket) {
                rocket.innerHTML = '🚀';
                rocket.style.transform = 'translateX(-50%) translateY(0px)';
            }
            userCrashBet = 0;
            userCashedOut = false;
            globalBettingActive = false;
            globalCrashActive = false;
        }
        
        function showComingSoon() {
            showNotification('Coming Soon! Stay tuned ⏳', 'info');
        }
        
        function updateUI() {
            document.getElementById('user').textContent = currentUser || 'Player';
            document.getElementById('ed').textContent = currentEdition || 'Bedrock';
            updateAllBalances();
        }
        
        function login() {
            const username = document.getElementById('username').value.trim();
            const edition = document.getElementById('edition').value;
            if (!username) {
                showNotification('Username required! ⚠️', 'error');
                return;
            }
            currentUser = username;
            currentEdition = edition;
            balance = parseFloat(localStorage.getItem(`${username}_balance`)) || 0;
            localStorage.setItem('username', username);
            localStorage.setItem(`${username}_edition`, edition);
            localStorage.setItem(`${username}_balance`, balance.toString());
            
            // Log login
            logTransaction('login', { user: username, edition: edition, initialBalance: balance });
            
            isAdmin = username === 'Zh3eOnDiscord2025' && edition === 'Java';
            
            document.body.classList.add('logged-in');
            showScreen('dashboard');
            updateUI();
            addAdminButton();
            showNotification(`Welcome, ${username}! Edition: ${edition} 🎮`, 'success');
            if (isAdmin) {
                showNotification('Admin mode active! Access the Admin Panel 🔧', 'success');
            }
        }
        
        function logout() {
            const adminBtn = document.querySelector('.admin-btn');
            if (adminBtn) adminBtn.remove();
            localStorage.removeItem('username');
            document.body.classList.remove('logged-in');
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('visible');
                s.classList.add('hidden');
            });
            document.getElementById('login').classList.remove('hidden');
            document.getElementById('login').classList.add('visible');
            document.getElementById('username').value = '';
            currentUser = '';
            currentEdition = '';
            balance = 0;
            isAdmin = false;
            showNotification('Logged out safely! 👋', 'info');
            currentScreen = 'login';
        }
        
        function showNotification(message, type = 'info') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.background = type === 'error' ? 'rgba(255,0,0,0.95)' : type === 'success' ? 'rgba(0,255,0,0.95)' : 'rgba(0,31,63,0.95)';
            notif.style.borderLeftColor = type === 'error' ? '#ff0000' : type === 'success' ? '#00ff00' : '#7b2cbf';
            notif.classList.add('notification');
            setTimeout(() => {
                notif.classList.remove('notification');
            }, 3000);
        }
        
        function deposit() {
            showNotification(`Contact Admin on Discord (ID: 1057661388157362277) to deposit! 📩 Provide amount & proof.`, 'info');
        }
        
        function withdraw() {
            if (balance <= 0) {
                showNotification('Insufficient balance! 💸', 'error');
                return;
            }
            showNotification(`Contact Admin on Discord (ID: 1057661388157362277) to withdraw $${formatBalance(balance)}! 🏦 Provide details.`, 'info');
        }

        function loadUsers(filter = '') {
            users = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.endsWith('_balance')) {
                    const username = key.replace('_balance', '');
                    if (username.toLowerCase().includes(filter.toLowerCase())) {
                        const edition = localStorage.getItem(`${username}_edition`) || 'Unknown';
                        const bal = parseFloat(localStorage.getItem(key)) || 0;
                        users.push({ username, edition, balance: bal });
                    }
                }
            }
            renderUsersTable();
        }

        function renderUsersTable() {
            const tableDiv = document.getElementById('usersTable');
            if (users.length === 0) {
                tableDiv.innerHTML = '<p style="text-align: center; color: #ccc; padding: 20px;">No users found.</p>';
                return;
            }
            let html = '<table>';
            html += '<tr><th>Username</th><th>Edition</th><th>Balance</th></tr>';
            users.forEach(user => {
                html += `<tr><td>${user.username}</td><td>${user.edition}</td><td>$${formatBalance(user.balance)}</td></tr>`;
            });
            html += '</table>';
            tableDiv.innerHTML = html;
        }

        function doDeposit() {
            const user = document.getElementById('selectedUser').value.trim();
            const amtStr = document.getElementById('adjustAmount').value;
            const amt = parseBet(amtStr);
            if (!user || isNaN(amt) || amt <= 0) {
                showNotification('Invalid input! ⚠️', 'error');
                return;
            }
            const currentBal = parseFloat(localStorage.getItem(`${user}_balance`)) || 0;
            const newBal = currentBal + amt;
            localStorage.setItem(`${user}_balance`, newBal.toString());
            if (!localStorage.getItem(`${user}_edition`)) {
                localStorage.setItem(`${user}_edition`, 'Bedrock');
            }
            // Log deposit
            logTransaction('deposit', { user: user, amount: amt, oldBalance: currentBal, newBalance: newBal });
            showNotification(`Deposited $${formatBalance(amt)} to ${user}. New balance: $${formatBalance(newBal)} 💳`, 'success');
            document.getElementById('selectedUser').value = '';
            document.getElementById('adjustAmount').value = '';
            loadUsers(document.getElementById('userSearch').value);
        }

        function doWithdraw() {
            const user = document.getElementById('selectedUser').value.trim();
            const amtStr = document.getElementById('adjustAmount').value;
            const amt = parseBet(amtStr);
            if (!user || isNaN(amt) || amt <= 0) {
                showNotification('Invalid input! ⚠️', 'error');
                return;
            }
            const currentBal = parseFloat(localStorage.getItem(`${user}_balance`)) || 0;
            if (amt > currentBal) {
                showNotification(`Insufficient balance for ${user}! Current: $${formatBalance(currentBal)} 🏦`, 'error');
                return;
            }
            const newBal = currentBal - amt;
            localStorage.setItem(`${user}_balance`, newBal.toString());
            // Log withdraw
            logTransaction('withdraw', { user: user, amount: amt, oldBalance: currentBal, newBalance: newBal });
            showNotification(`Withdrew $${formatBalance(amt)} from ${user}. New balance: $${formatBalance(newBal)} 🏦`, 'success');
            document.getElementById('selectedUser').value = '';
            document.getElementById('adjustAmount').value = '';
            loadUsers(document.getElementById('userSearch').value);
        }
        
        // Blackjack functions
        function handValue(hand) {
            let val = hand.reduce((a, c) => a + c.value, 0);
            let aces = hand.filter(c => c.rank === 'A').length;
            while (val > 21 && aces > 0) {
                val -= 10;
                aces--;
            }
            return val;
        }
        
        function playBlackjack() {
            // Reset previous game
            document.querySelectorAll('#blackjack-screen .controls button').forEach(btn => btn.disabled = false);
            document.getElementById('bj-hand-player').innerHTML = '';
            document.getElementById('bj-hand-dealer').innerHTML = '';
            document.getElementById('bj-result').textContent = '';
            playerHand = [];
            dealerHand = [];
            
            const betStr = document.getElementById('bet').value;
            bjBet = parseBet(betStr);
            if (bjBet > balance || bjBet <= 0) {
                showNotification('Invalid bet! ⚠️', 'error');
                return;
            }
            balance -= bjBet;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            
            const suits = ['♠', '♥', '♦', '♣'];
            const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            function getCard() {
                const suit = suits[Math.floor(Math.random() * suits.length)];
                const rank = ranks[Math.floor(Math.random() * ranks.length)];
                const value = rank === 'A' ? 11 : ['J','Q','K'].includes(rank) ? 10 : parseInt(rank);
                return { rank, suit, value };
            }
            
            playerHand = [getCard(), getCard()];
            dealerHand = [getCard(), getCard()];
            
            document.getElementById('bj-hand-player').innerHTML = playerHand.map(c => `<span class="card">${c.rank}${c.suit}</span>`).join('');
            document.getElementById('bj-hand-dealer').innerHTML = `<span class="card">${dealerHand[0].rank}${dealerHand[0].suit}</span> <span class="card">?</span>`;
            
            document.getElementById('bj-result').textContent = `Hand Value: ${handValue(playerHand)}`;
        }
        
        function bjHit() {
            if (playerHand.length >= 5) return;
            const suits = ['♠', '♥', '♦', '♣'];
            const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const suit = suits[Math.floor(Math.random() * suits.length)];
            const rank = ranks[Math.floor(Math.random() * ranks.length)];
            const value = rank === 'A' ? 11 : ['J','Q','K'].includes(rank) ? 10 : parseInt(rank);
            playerHand.push({ rank, suit, value });
            document.getElementById('bj-hand-player').innerHTML = playerHand.map(c => `<span class="card">${c.rank}${c.suit}</span>`).join('');
            const pv = handValue(playerHand);
            document.getElementById('bj-result').textContent = `Hand Value: ${pv}`;
            if (pv > 21) endBlackjack();
        }
        
        function bjStand() {
            while (handValue(dealerHand) < 17) {
                const suits = ['♠', '♥', '♦', '♣'];
                const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
                const suit = suits[Math.floor(Math.random() * suits.length)];
                const rank = ranks[Math.floor(Math.random() * ranks.length)];
                const value = rank === 'A' ? 11 : ['J','Q','K'].includes(rank) ? 10 : parseInt(rank);
                dealerHand.push({ rank, suit, value });
            }
            document.getElementById('bj-hand-dealer').innerHTML = dealerHand.map(c => `<span class="card">${c.rank}${c.suit}</span>`).join('');
            endBlackjack();
        }
        
        function endBlackjack() {
            const pv = handValue(playerHand);
            const dv = handValue(dealerHand);
            let win = false;
            if (pv > 21) {
                document.getElementById('bj-result').textContent = `Bust! You lose. 😵 Dealer: ${dv}`;
            } else if (dv > 21) {
                win = true;
                document.getElementById('bj-result').textContent = `Dealer busts! You win! 🎉 Payout: $${formatBalance(bjBet * 2)}`;
                balance += bjBet * 2;
            } else if (pv > dv) {
                win = true;
                document.getElementById('bj-result').textContent = `You win! 🎉 Payout: $${formatBalance(bjBet * 2)}`;
                balance += bjBet * 2;
            } else if (pv === dv) {
                document.getElementById('bj-result').textContent = `Push! 💤 Refund: $${formatBalance(bjBet)}`;
                balance += bjBet;
            } else {
                document.getElementById('bj-result').textContent = `Dealer wins! 😤 Dealer: ${dv}`;
            }
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            document.querySelectorAll('#blackjack-screen .controls button').forEach(btn => btn.disabled = true);
        }
        
        // Mines functions
        function startMines() {
            const betStr = document.getElementById('minesbet').value;
            minesBet = parseBet(betStr);
            minesNum = parseInt(document.getElementById('minesnum').value);
            if (minesBet > balance || minesBet <= 0) {
                showNotification('Invalid bet! ⚠️', 'error');
                return;
            }
            balance -= minesBet;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            
            minesGrid = Array(25).fill(false);
            for (let i = 0; i < minesNum; i++) {
                let pos;
                do { pos = Math.floor(Math.random() * 25); } while (minesGrid[pos]);
                minesGrid[pos] = true;
            }
            minesRevealed = 0;
            gameActive = true;
            renderMines();
            const multiplier = computeMinesMultiplier(minesRevealed, minesNum);
            document.getElementById('mines-result').textContent = `Revealed: ${minesRevealed}/${25 - minesNum} | Potential Payout: x${multiplier.toFixed(2)}`;
            document.getElementById('cashout-btn').style.display = 'block';
        }
        
        function renderMines() {
            const grid = document.getElementById('mine-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.classList.add('mine-cell');
                cell.textContent = '?';
                cell.onclick = () => revealMine(i);
                grid.appendChild(cell);
            }
        }
        
        function revealMine(idx) {
            if (!gameActive) return;
            const cells = document.querySelectorAll('#mine-grid .mine-cell');
            const cell = cells[idx];
            cell.classList.add('disabled');
            if (minesGrid[idx]) {
                cell.textContent = '💣';
                cell.classList.add('boom');
                gameActive = false;
                document.getElementById('cashout-btn').style.display = 'none';
                endMines(false);
            } else {
                cell.textContent = '💎';
                minesRevealed++;
                const multiplier = computeMinesMultiplier(minesRevealed, minesNum);
                document.getElementById('mines-result').textContent = `Revealed: ${minesRevealed}/${25 - minesNum} | Potential Payout: x${multiplier.toFixed(2)}`;
                if (minesRevealed === 25 - minesNum) {
                    gameActive = false;
                    document.getElementById('cashout-btn').style.display = 'none';
                    endMines(true);
                }
            }
        }

        function cashOutMines() {
            if (!gameActive) return;
            gameActive = false;
            document.getElementById('cashout-btn').style.display = 'none';
            const multiplier = computeMinesMultiplier(minesRevealed, minesNum);
            const payout = minesBet * multiplier;
            balance += payout;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            document.getElementById('mines-result').textContent += ` | Cashed out! +$${formatBalance(payout)} 💰`;
            // Disable all cells
            document.querySelectorAll('.mine-cell').forEach(cell => cell.classList.add('disabled'));
        }
        
        function endMines(win) {
            if (win) {
                const multiplier = computeMinesMultiplier(minesRevealed, minesNum);
                const payout = minesBet * multiplier;
                balance += payout;
                document.getElementById('mines-result').textContent += ` | Win! +$${formatBalance(payout)} 🎉`;
            } else {
                document.getElementById('mines-result').textContent += ` | Boom! Loss 💥`;
            }
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            // Disable all cells
            document.querySelectorAll('.mine-cell').forEach(cell => cell.classList.add('disabled'));
        }
        
        // Dice functions
        function playDice() {
            const betStr = document.getElementById('dicebet').value;
            diceBet = parseBet(betStr);
            const choice = document.getElementById('dicechoice').value;
            if (diceBet > balance || diceBet <= 0) {
                showNotification('Invalid bet! ⚠️', 'error');
                return;
            }
            balance -= diceBet;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            
            const die1 = Math.floor(Math.random() * 6) + 1;
            const die2 = Math.floor(Math.random() * 6) + 1;
            const sum = die1 + die2;
            document.getElementById('dice-display').innerHTML = `🎲 ${die1} + 🎲 ${die2} = ${sum}`;
            
            let win = false;
            if (choice === 'over' && sum > 7) win = true;
            else if (choice === 'under' && sum < 7) win = true;
            else if (sum === 7) {
                balance += diceBet;
                document.getElementById('dice-result').textContent = `Push on 7! Refund: $${formatBalance(diceBet)} 💤`;
            }
            
            if (win) {
                const payout = diceBet * 2;
                balance += payout;
                document.getElementById('dice-result').textContent = `You win! 🎉 Payout: $${formatBalance(payout)}`;
            } else {
                document.getElementById('dice-result').textContent = `You lose! 😤`;
            }
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
        }
        
        // Towers functions
        function startTowers() {
            const betStr = document.getElementById('towersbet').value;
            towersBet = parseBet(betStr);
            if (towersBet > balance || towersBet <= 0) {
                showNotification('Invalid bet! ⚠️', 'error');
                return;
            }
            balance -= towersBet;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            
            towersGrid = [];
            for (let row = 0; row < 5; row++) {
                const rowCells = ['safe', 'safe', 'safe'];
                const skullPos = Math.floor(Math.random() * 3);
                rowCells[skullPos] = 'skull';
                towersGrid.push(rowCells);
            }
            currentTowerRow = 0;
            towersRevealed = 0;
            towersGameActive = true;
            renderTowers();
            document.getElementById('towers-result').textContent = 'Choose a cell in the bottom row to start climbing! Only one per row.';
            document.getElementById('cashout-btn-towers').style.display = 'block';
            updateTowerMultiplier();
        }

        function renderTowers() {
            const display = document.getElementById('towers-display');
            display.innerHTML = '';
            for (let r = 4; r >= 0; r--) {
                const rowDiv = document.createElement('div');
                rowDiv.classList.add('tower-row');
                for (let c = 0; c < 3; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('tower-cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    cell.textContent = '?';
                    cell.onclick = () => revealTowerCell(r, c);
                    rowDiv.appendChild(cell);
                }
                display.appendChild(rowDiv);
            }
            updateTowerRows();
        }

        function updateTowerRows() {
            const cells = document.querySelectorAll('.tower-cell');
            cells.forEach(cell => {
                const r = parseInt(cell.dataset.row);
                if (r < currentTowerRow) {
                    // Past rows already revealed
                } else if (r > currentTowerRow) {
                    cell.style.opacity = '0.5';
                    cell.style.pointerEvents = 'none';
                } else {
                    cell.style.opacity = '1';
                    cell.style.pointerEvents = 'auto';
                }
            });
        }

        function revealTowerCell(row, col) {
            if (row !== currentTowerRow || !towersGameActive) return;
            const cells = document.querySelectorAll('.tower-cell');
            const cell = Array.from(cells).find(c => parseInt(c.dataset.row) === row && parseInt(c.dataset.col) === col);
            if (!cell) return;
            cell.classList.add('revealed');
            if (towersGrid[row][col] === 'skull') {
                cell.textContent = '💀';
                cell.classList.add('skull');
                towersGameActive = false;
                document.getElementById('cashout-btn-towers').style.display = 'none';
                endTowers(false);
            } else {
                cell.textContent = '💎';
                cell.classList.add('safe');
                towersRevealed++;
                currentTowerRow++;
                if (currentTowerRow === 5) {
                    towersGameActive = false;
                    document.getElementById('cashout-btn-towers').style.display = 'none';
                    endTowers(true);
                    return;
                }
                updateTowerMultiplier();
                updateTowerRows();
            }
            // Disable current row cells
            const currentRowCells = Array.from(cells).filter(c => parseInt(c.dataset.row) === row);
            currentRowCells.forEach(c => {
                c.classList.add('revealed');
                c.style.pointerEvents = 'none';
            });
        }

        function updateTowerMultiplier() {
            const multiplier = 1 + 0.5 * towersRevealed;
            document.getElementById('towers-result').textContent = `Revealed: ${towersRevealed}/5 | Potential Payout: x${multiplier.toFixed(2)}`;
        }

        function cashOutTowers() {
            if (!towersGameActive) return;
            towersGameActive = false;
            document.getElementById('cashout-btn-towers').style.display = 'none';
            const multiplier = 1 + 0.5 * towersRevealed;
            const payout = towersBet * multiplier;
            balance += payout;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            document.getElementById('towers-result').textContent += ` | Cashed out! +$${formatBalance(payout)} 💰`;
            document.querySelectorAll('.tower-cell').forEach(c => c.style.pointerEvents = 'none');
        }

        function endTowers(win) {
            if (win) {
                const multiplier = 1 + 0.5 * 5;
                const payout = towersBet * multiplier;
                balance += payout;
                document.getElementById('towers-result').textContent += ` | Full climb! +$${formatBalance(payout)} 🎉`;
            } else {
                document.getElementById('towers-result').textContent += ` | Skull! Loss 💥`;
            }
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            document.querySelectorAll('.tower-cell').forEach(c => c.style.pointerEvents = 'none');
        }
        
        // Crash functions
        function startBettingPhase() {
            globalBettingActive = true;
            globalCrashActive = false;
            globalLaunchTime = Date.now() + 15000;
            document.getElementById('crash-area').style.display = 'block';
            document.getElementById('crash-input').style.display = 'flex';
            document.getElementById('multiplier').textContent = '1.00x';
            const rocket = document.getElementById('rocket');
            if (rocket) {
                rocket.innerHTML = '🚀';
                rocket.style.transform = 'translateX(-50%) translateY(0px)';
            }
            document.getElementById('countdown').textContent = 'Launch in 15s';
            document.getElementById('cashout-btn-crash').style.display = 'none';
            updateCountdown();
        }

        function updateCountdown() {
            if (!globalBettingActive) return;
            const elapsed = (Date.now() - (globalLaunchTime - 15000)) / 1000;
            const remaining = 15 - elapsed;
            if (remaining <= 0) {
                launchRocket();
                return;
            }
            document.getElementById('countdown').textContent = `Launch in ${Math.ceil(remaining)}s`;
            requestAnimationFrame(updateCountdown);
        }

        function launchRocket() {
            globalBettingActive = false;
            globalCrashActive = true;
            globalStartTime = Date.now();
            const lambda = 0.05;
            const crashSeconds = -Math.log(1 - Math.random()) / lambda;
            globalCrashMultiplier = 1 + 0.01 * crashSeconds;
            document.getElementById('countdown').textContent = '';
            document.getElementById('crash-input').style.display = 'none';
            if (userCrashBet > 0 && !userCashedOut) {
                document.getElementById('cashout-btn-crash').style.display = 'block';
            }
            const rocket = document.getElementById('rocket');
            if (rocket) {
                rocket.style.transform = 'translateX(-50%) translateY(0px)';
            }
            updateGlobalCrash();
        }

        function updateGlobalCrash() {
            if (!globalCrashActive) return;
            const elapsed = (Date.now() - globalStartTime) / 1000;
            globalCurrentMultiplier = 1 + 0.01 * elapsed;
            document.getElementById('multiplier').textContent = globalCurrentMultiplier.toFixed(2) + 'x';
            const rocket = document.getElementById('rocket');
            if (rocket) {
                rocket.style.transform = `translateX(-50%) translateY(${-elapsed * 50}px)`;
            }
            if (globalCurrentMultiplier >= globalCrashMultiplier) {
                globalCrash();
                return;
            }
            requestAnimationFrame(updateGlobalCrash);
        }

        function globalCrash() {
            globalCrashActive = false;
            const elapsed = (Date.now() - globalStartTime) / 1000;
            globalCurrentMultiplier = 1 + 0.01 * elapsed;
            document.getElementById('multiplier').textContent = globalCurrentMultiplier.toFixed(2) + 'x';
            const rocket = document.getElementById('rocket');
            if (rocket) {
                rocket.innerHTML = '💥';
                rocket.style.transform += ' scale(2)';
            }
            if (userCrashBet > 0 && !userCashedOut) {
                document.getElementById('crash-result').textContent = `Crashed at ${globalCurrentMultiplier.toFixed(2)}x! Lost $${formatBalance(userCrashBet)} 😵`;
                userCrashBet = 0;
            }
            document.getElementById('cashout-btn-crash').style.display = 'none';
            setTimeout(() => {
                const rocket = document.getElementById('rocket');
                if (rocket) {
                    rocket.innerHTML = '🚀';
                    rocket.style.transform = 'translateX(-50%) translateY(0px)';
                }
                document.getElementById('crash-result').textContent = `Crashed at ${globalCurrentMultiplier.toFixed(2)}x! Next round soon...`;
                setTimeout(() => {
                    startBettingPhase();
                }, 2000);
            }, 3000);
        }

        function betOnCrash() {
            const betStr = document.getElementById('crashbet').value;
            const betAmount = parseBet(betStr);
            if (betAmount > balance || betAmount <= 0 || userCrashBet > 0) {
                showNotification('Invalid bet or already bet this round! ⚠️', 'error');
                return;
            }
            if (!globalBettingActive) {
                showNotification('Bets closed! Wait for next round. ⚠️', 'error');
                return;
            }
            balance -= betAmount;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            userCrashBet = betAmount;
            userCashedOut = false;
            document.getElementById('cashout-btn-crash').style.display = 'block';
            showNotification(`Bet $${formatBalance(userCrashBet)} on crash! Cash out anytime. 🚀`, 'success');
        }

        function cashOutCrash() {
            if (userCrashBet <= 0 || userCashedOut || !globalCrashActive) return;
            userCashedOut = true;
            const payout = userCrashBet * globalCurrentMultiplier;
            balance += payout;
            localStorage.setItem(`${currentUser}_balance`, balance.toString());
            updateAllBalances();
            document.getElementById('crash-result').textContent = `Cashed out at ${globalCurrentMultiplier.toFixed(2)}x! +$${formatBalance(payout)} 💰`;
            document.getElementById('cashout-btn-crash').style.display = 'none';
            userCrashBet = 0;
            showNotification(`Cashed out successfully! 🎉`, 'success');
        }
        
        // Search listener
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('userSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    loadUsers(e.target.value);
                });
            }
        });
        
        // Init
        loadData();
        
        // Enter key for login and chat
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && currentScreen === 'login') {
                login();
            } else if (e.key === 'Enter' && document.body.classList.contains('logged-in')) {
                sendMessage();
            }
        });
    </script>
</body>
</html>
