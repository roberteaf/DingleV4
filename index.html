<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎮</text></svg>">
    <title>Minecraft Gamble Hub 🎮💎</title>
    <!-- Firebase SDK v12.4.0 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js';
        import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, addDoc, onSnapshot, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js';
        window.firebaseApp = { initializeApp, getFirestore, collection, doc, getDoc, setDoc, updateDoc, addDoc, onSnapshot, query, orderBy, limit };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #000000 0%, #001f3f 50%, #7b2cbf 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body.logged-in .screen {
            left: 300px;
            width: calc(100% - 300px);
        }
        
        body:not(.logged-in) .screen {
            left: 0;
            width: 100%;
        }
        
        .chat-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 300px;
            height: 100vh;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(123, 44, 191, 0.2));
            backdrop-filter: blur(10px);
            z-index: 5;
            display: none;
            flex-direction: column;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.5);
        }
        
        body.logged-in .chat-sidebar {
            display: flex;
        }
        
        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .message {
            padding: 10px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            word-wrap: break-word;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .message small {
            opacity: 0.7;
            font-size: 0.8em;
            display: block;
            margin-bottom: 5px;
        }
        
        #chat-input-container {
            padding: 15px;
            border-top: 1px solid rgba(123, 44, 191, 0.3);
            display: flex;
            gap: 10px;
        }
        
        #chat-input {
            flex: 1;
            padding: 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(123, 44, 191, 0.3);
            color: #fff;
            font-family: 'Roboto', sans-serif;
        }
        
        #chat-input:focus {
            outline: none;
            box-shadow: 0 0 10px #7b2cbf;
        }
        
        .screen {
            position: absolute;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: opacity 0.5s ease-in-out;
            z-index: 1;
        }
        
        .hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .header {
            width: 100%;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(123, 44, 191, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
            position: relative;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header-left h1 {
            font-size: 1.8em;
            text-shadow: 0 0 10px #7b2cbf;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px #7b2cbf; }
            to { text-shadow: 0 0 20px #7b2cbf, 0 0 30px #7b2cbf; }
        }
        
        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }
        
        .balance {
            font-size: 1.3em;
            padding: 8px 15px;
            background: linear-gradient(145deg, rgba(0, 31, 63, 0.9), rgba(123, 44, 191, 0.3));
            border-radius: 20px;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(123, 44, 191, 0.4);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            font-family: 'Roboto', sans-serif;
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(123, 44, 191, 0.3));
            color: #ffffff;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(123, 44, 191, 0.5);
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(123, 44, 191, 0.4));
        }
        
        .logout {
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.3), rgba(123, 44, 191, 0.2)) !important;
        }
        
        .logout:hover {
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.5), rgba(123, 44, 191, 0.3)) !important;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }
        
        .game-card {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.6), rgba(123, 44, 191, 0.2));
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .game-card:hover::before {
            left: 100%;
        }
        
        .game-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: #7b2cbf;
            box-shadow: 0 12px 40px rgba(123, 44, 191, 0.6);
        }
        
        .game-icon {
            font-size: 4em;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(123, 44, 191, 0.5));
            transition: transform 0.3s ease;
        }
        
        .game-card:hover .game-icon {
            transform: scale(1.2);
        }
        
        .game-title {
            font-size: 1.4em;
            font-weight: 700;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .coming-soon {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .coming-soon:hover {
            transform: none;
            border-color: transparent;
            box-shadow: none;
        }
        
        .game-area {
            width: 100%;
            max-width: 800px;
            padding: 40px;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.7), rgba(123, 44, 191, 0.1));
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.6s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .back-btn {
            align-self: flex-start;
            background: linear-gradient(145deg, rgba(123, 44, 191, 0.3), rgba(0, 0, 0, 0.5));
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        input, select {
            padding: 12px 18px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(123, 44, 191, 0.3);
            color: #fff;
            font-size: 1em;
            min-width: 80px;
        }
        
        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 15px #7b2cbf;
            border-color: #7b2cbf;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .controls button {
            padding: 12px 20px;
            font-size: 1em;
            border-radius: 15px;
            background: linear-gradient(145deg, rgba(0, 255, 0, 0.2), rgba(123, 44, 191, 0.3));
        }
        
        .result {
            font-size: 1.2em;
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            min-height: 20px;
        }
        
        .mine-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 20px 0;
        }
        
        .mine-cell {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(123, 44, 191, 0.2));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .mine-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(123, 44, 191, 0.5);
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(123, 44, 191, 0.3));
        }
        
        .mine-cell.boom {
            background: linear-gradient(145deg, #ff0000, #cc0000);
            animation: explode 0.5s ease;
            transform: scale(1.2);
        }
        
        .mine-cell.disabled {
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @keyframes explode {
            0% { transform: scale(1); }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .dice-display {
            font-size: 4em;
            margin: 20px 0;
            text-shadow: 0 0 10px #ffff00;
        }
        
        .tower-display {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 20px 0;
        }
        
        .tower-row {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .tower-cell {
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(123, 44, 191, 0.2));
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .tower-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(123, 44, 191, 0.5);
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(123, 44, 191, 0.3));
        }
        
        .tower-cell.revealed {
            pointer-events: none;
        }
        
        .tower-cell.safe {
            background: linear-gradient(145deg, #00ff00, #00cc00);
        }
        
        .tower-cell.skull {
            background: linear-gradient(145deg, #ff0000, #cc0000);
            animation: explode 0.5s ease;
        }
        
        .card-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .card {
            display: inline-block;
            background: linear-gradient(145deg, #001f3f, #7b2cbf);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2em;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: flip 0.6s ease;
            min-width: 50px;
            text-align: center;
        }
        
        @keyframes flip {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0); }
        }
        
        #crash-area {
            position: relative;
            height: 400px;
            width: 100%;
            background: linear-gradient(to top, #001f3f, #000);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #rocket {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            transition: transform 0.1s ease-out;
            z-index: 2;
        }
        
        #multiplier {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            z-index: 2;
        }

        #countdown {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
            z-index: 2;
        }
        
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 15px 20px;
            background: rgba(0, 31, 63, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(123, 44, 191, 0.5);
            animation: slideInRight 0.5s ease-out;
            z-index: 1000;
            border-left: 4px solid #7b2cbf;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .coming-soon-content {
            text-align: center;
            font-size: 1.5em;
            opacity: 0.7;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(123, 44, 191, 0.3);
        }

        th {
            background: rgba(123, 44, 191, 0.2);
            font-weight: bold;
        }

        #cashout-btn, #cashout-btn-towers, #cashout-btn-crash {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.3), rgba(123, 44, 191, 0.3)) !important;
            padding: 12px 24px;
            font-size: 1em;
        }

        #cashout-btn:hover, #cashout-btn-towers:hover, #cashout-btn-crash:hover {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.5), rgba(123, 44, 191, 0.4)) !important;
        }

        .leaderboard {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .leaderboard h3 {
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #ffff00;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        #leaderboard {
            margin-top: 20px;
        }

        .auth-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .auth-toggle .btn {
            padding: 8px 12px;
            font-size: 0.9em;
        }

        .auth-form input, .auth-form select {
            width: 100%;
            margin-bottom: 15px;
        }

        .auth-form input[type="password"] {
            padding: 12px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(123, 44, 191, 0.3);
            color: #fff;
            font-size: 1em;
        }

        .auth-form input[type="password"]:focus {
            outline: none;
            box-shadow: 0 0 15px #7b2cbf;
            border-color: #7b2cbf;
        }
    </style>
</head>
<body>
    <div id="chat-sidebar" class="chat-sidebar">
        <div id="messages"></div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
    
    <div id="login" class="screen visible">
        <div class="main-content">
            <div style="text-align: center; max-width: 400px;">
                <h1 style="font-size: 3em; margin-bottom: 30px;">Minecraft Gamble Hub 🎮💎</h1>
                <div class="auth-toggle">
                    <button class="btn" onclick="setMode('login')">Login</button>
                    <button class="btn" onclick="setMode('signup')">Sign Up</button>
                </div>
                <div id="login-form" class="auth-form">
                    <input type="text" id="username" placeholder="Enter Username 👤" maxlength="20">
                    <select id="edition">
                        <option value="Bedrock">Bedrock Edition 🛏️</option>
                        <option value="Java">Java Edition ☕</option>
                    </select>
                    <input type="password" id="login-password" placeholder="Enter Password 🔒">
                    <button class="btn" onclick="login()" style="width: 100%; padding: 15px; font-size: 1.2em;">Login & Play 🎯</button>
                </div>
                <div id="signup-form" class="auth-form" style="display: none;">
                    <input type="text" id="signup-username" placeholder="Choose Username 👤" maxlength="20">
                    <select id="signup-edition">
                        <option value="Bedrock">Bedrock Edition 🛏️</option>
                        <option value="Java">Java Edition ☕</option>
                    </select>
                    <input type="password" id="signup-password" placeholder="Choose Password 🔒">
                    <input type="password" id="confirm-password" placeholder="Confirm Password 🔐">
                    <button class="btn" onclick="signUp()" style="width: 100%; padding: 15px; font-size: 1.2em;">Sign Up & Play 🎯</button>
                </div>
                <p style="margin-top: 20px; opacity: 0.7; font-family: 'Roboto', sans-serif;">Powered by Pixels & Bets ✨ | Now with Global Sync!</p>
            </div>
        </div>
    </div>
    
    <div id="dashboard" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <h1>Welcome, <span id="user"></span> (<span id="ed"></span>) 💎</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance">0.00</span> 💰 | Wins: <span id="wins">0</span> 🏆</div>
                <div class="header-buttons">
                    <button class="btn" onclick="showLeaderboard()">🏆 Leaderboard</button>
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="games-grid">
                <div class="game-card" onclick="showScreen('mines')">
                    <div class="game-icon">💎💣</div>
                    <h3 class="game-title">Mines</h3>
                </div>
                <div class="game-card" onclick="showScreen('dice')">
                    <div class="game-icon">🎲🎲</div>
                    <h3 class="game-title">Dice</h3>
                </div>
                <div class="game-card" onclick="showScreen('towers')">
                    <div class="game-icon">🏗️</div>
                    <h3 class="game-title">Towers</h3>
                </div>
                <div class="game-card" onclick="showScreen('blackjack')">
                    <div class="game-icon">🃏</div>
                    <h3 class="game-title">Blackjack</h3>
                </div>
                <div class="game-card" onclick="showScreen('crash')">
                    <div class="game-icon">🚀</div>
                    <h3 class="game-title">Crash</h3>
                </div>
                <div class="game-card coming-soon" onclick="showComingSoon()">
                    <div class="game-icon">⏳</div>
                    <h3 class="game-title">Coming Soon</h3>
                </div>
            </div>
            <div id="leaderboard" class="leaderboard" style="display: none;">
                <h3>Global Leaderboard 🏆</h3>
                <div id="lb-content"></div>
            </div>
        </div>
    </div>

    <div id="admin" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Admin Dashboard 🔧</h1>
            </div>
            <div class="header-right">
                <div class="balance">Admin Mode Active 👑</div>
                <div class="header-buttons">
                    <button class="btn" onclick="downloadLog()">📥 Download Log</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div style="max-width: 800px; width: 100%;">
                <h2 style="text-align: center; margin-bottom: 20px;">User Management</h2>
                <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <input type="text" id="userSearch" placeholder="Search users..." style="width: 300px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #7b2cbf; color: white;" oninput="loadUsers(this.value)">
                    <button class="btn" onclick="loadUsers(document.getElementById('userSearch').value)">Refresh 🔄</button>
                </div>
                <div id="usersTable" style="overflow-y: auto; max-height: 400px; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 10px;"></div>
                <div style="margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 15px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 10px;">
                    <h3 style="margin: 0; flex-basis: 100%; text-align: center;">Adjust Balance for User</h3>
                    <input type="text" id="selectedUser" placeholder="Enter Username (e.g. NewUser)" style="width: 200px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #7b2cbf; color: white;">
                    <input type="text" id="adjustAmount" placeholder="Amount (e.g. 100k)" style="width: 150px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #7b2cbf; color: white;">
                    <button class="btn" onclick="doDeposit()" style="background: linear-gradient(145deg, rgba(0,255,0,0.3), rgba(0,200,0,0.2));">Deposit 💳</button>
                    <button class="btn" onclick="doWithdraw()" style="background: linear-gradient(145deg, rgba(255,0,0,0.3), rgba(200,0,0,0.2));">Withdraw 🏦</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="mines-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Mines 💣</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-mines">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="minesbet" placeholder="10 or 1k" value="10">
                    <label>Mines:</label>
                    <select id="minesnum">
                        <option>1</option>
                        <option>3</option>
                        <option>5</option>
                    </select>
                    <button class="btn" onclick="startMines()">Start 🔍</button>
                </div>
                <div id="mine-grid" class="mine-grid"></div>
                <button id="cashout-btn" class="btn" onclick="cashOutMines()" style="display: none;">Cash Out 💰</button>
                <div id="mines-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="dice-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Dice 🎲</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-dice">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="dicebet" placeholder="10 or 1k" value="10">
                    <select id="dicechoice">
                        <option value="over">Over 7 (Win if >7)</option>
                        <option value="under">Under 7 (Win if <7)</option>
                    </select>
                    <button class="btn" onclick="playDice()">Roll 🎲</button>
                </div>
                <div id="dice-display" class="dice-display"></div>
                <div id="dice-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="towers-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Towers 🏗️</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-towers">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="towersbet" placeholder="10 or 1k" value="10">
                    <button class="btn" onclick="startTowers()">Build & Climb 🧗</button>
                </div>
                <div id="towers-display" class="tower-display"></div>
                <button id="cashout-btn-towers" class="btn" onclick="cashOutTowers()" style="display: none;">Cash Out 💰</button>
                <div id="towers-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="blackjack-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Blackjack 🃏</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-blackjack">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group">
                    <label>Bet: $</label>
                    <input type="text" id="bet" placeholder="10 or 1k" value="10">
                    <button class="btn" onclick="playBlackjack()">Deal Cards 🎴</button>
                </div>
                <div id="bj-hand-player" class="card-display"></div>
                <div style="text-align: center; margin: 10px 0;">vs</div>
                <div id="bj-hand-dealer" class="card-display"></div>
                <div class="controls">
                    <button class="btn" onclick="bjHit()">Hit ➡️</button>
                    <button class="btn" onclick="bjStand()">Stand 🛑</button>
                </div>
                <div id="bj-result" class="result"></div>
            </div>
        </div>
    </div>

    <div id="crash-screen" class="screen hidden">
        <div class="header">
            <div class="header-left">
                <button class="btn back-btn" onclick="showScreen('dashboard')">← Back</button>
                <h1>Crash 🚀</h1>
            </div>
            <div class="header-right">
                <div class="balance">Balance: $<span id="balance-crash">0.00</span> 💰</div>
                <div class="header-buttons">
                    <button class="btn" onclick="deposit()">💳 Deposit</button>
                    <button class="btn" onclick="withdraw()">🏦 Withdraw</button>
                    <button class="btn logout" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="game-area">
                <div class="input-group" id="crash-input">
                    <label>Bet: $</label>
                    <input type="text" id="crashbet" placeholder="10 or 1k" value="10">
                    <button class="btn" onclick="betOnCrash()">Bet 🚀</button>
                </div>
                <div id="crash-area" style="display: none;">
                    <div id="countdown"></div>
                    <div id="rocket">🚀</div>
                    <div id="multiplier">1.00x</div>
                </div>
                <button id="cashout-btn-crash" class="btn" onclick="cashOutCrash()" style="display: none;">Cash Out 💰</button>
                <div id="crash-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <div id="notification"></div>

    <script type="module">
        console.log('Minecraft Gamble Hub v2 - Global Sync Loaded! 🎮💎');
        
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyDapCVzp1WaBvvJWvqxzfXaKB1-w7AmUp0",
          authDomain: "minecraft-gamble-hub.firebaseapp.com",
          projectId: "minecraft-gamble-hub",
          storageBucket: "minecraft-gamble-hub.firebasestorage.app",
          messagingSenderId: "68102221057",
          appId: "1:68102221057:web:50203f667eaa1b43bd7f00",
          measurementId: "G-H955N69PH7"
        };
        
        const { initializeApp, getFirestore, collection, doc, getDoc, setDoc, updateDoc, addDoc, onSnapshot, query, orderBy, limit } = window.firebaseApp;
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let currentUser = '';
        let currentEdition = '';
        let balance = 0.00;
        let wins = 0;
        let currentScreen = 'login';
        let isAdmin = false;
        let userDoc = null;
        let messagesUnsub = null;
        let leaderboardUnsub = null;
        let usersUnsub = null;
        let userUnsub = null;
        
        // Game state variables (local for gameplay)
        let playerHand = [], dealerHand = [], bjBet = 0;
        let minesGrid = [], minesNum = 0, minesRevealed = 0, minesBet = 0, gameActive = false;
        let diceBet = 0;
        let towersGrid = [], currentTowerRow = 0, towersRevealed = 0, towersGameActive = false, towersBet = 0;
        let users = [];
        
        // Crash global state (still local per tab for simplicity; could sync if needed)
        let globalCrashActive = false;
        let globalBettingActive = false;
        let globalStartTime;
        let globalLaunchTime;
        let globalCrashMultiplier;
        let globalCurrentMultiplier = 1.00;
        let userCrashBet = 0;
        let userCashedOut = false;
        
        const ADMIN_USERNAME = 'Zh3eOnDiscord2025';
        const ADMIN_PASSWORD = 'Agroxzy2009.11';
        
        function formatBalance(bal) {
            if (bal >= 1e9) return (bal / 1e9).toFixed(1) + 'B';
            if (bal >= 1e6) return (bal / 1e6).toFixed(1) + 'M';
            if (bal >= 1e3) return (bal / 1e3).toFixed(1) + 'K';
            return bal.toFixed(2);
        }

        function parseBet(str) {
            str = str.toLowerCase().trim();
            let num = parseFloat(str);
            if (isNaN(num)) num = 0;
            if (str.includes('k')) num *= 1000;
            else if (str.includes('m')) num *= 1e6;
            else if (str.includes('b')) num *= 1e9;
            return num;
        }

        async function loadUserData() {
            try {
                if (!currentUser) return;
                const userRef = doc(db, 'users', currentUser);
                userDoc = userRef;
                if (userUnsub) userUnsub();
                userUnsub = onSnapshot(userRef, (snap) => {
                    if (snap.exists()) {
                        const data = snap.data();
                        if (!data.edition) {
                            updateDoc(userRef, { edition: currentEdition });
                            data.edition = currentEdition;
                        }
                        balance = data.balance || 0;
                        wins = data.wins || 0;
                        updateAllBalances();
                        document.getElementById('wins').textContent = wins;
                    } else {
                        showNotification('User data not found! ⚠️', 'error');
                    }
                });
                isAdmin = currentUser === ADMIN_USERNAME && currentEdition === 'Java';
                if (isAdmin) {
                    // Show admin button or screen if needed
                }
            } catch (error) {
                console.error('Load user data error:', error);
                showNotification('Failed to load user data! ⚠️', 'error');
            }
        }

        function updateAllBalances() {
            const formatted = formatBalance(balance);
            ['balance', 'balance-mines', 'balance-dice', 'balance-towers', 'balance-blackjack', 'balance-crash'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = formatted;
            });
        }

        function updateUserWins(newWins) {
            wins = newWins;
            document.getElementById('wins').textContent = newWins;
            if (userDoc) {
                updateDoc(userDoc, { wins: newWins });
            }
        }

        function updateUserBalance(newBalance, isWin = false) {
            balance = newBalance;
            updateAllBalances();
            if (userDoc) {
                updateDoc(userDoc, { balance: newBalance });
                if (isWin) {
                    updateUserWins(wins + 1);
                }
            }
        }

        // Synced Chat
        function loadMessages() {
            if (messagesUnsub) messagesUnsub();
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            const q = query(collection(db, 'messages'), orderBy('time', 'asc'), limit(50));
            messagesUnsub = onSnapshot(q, (snapshot) => {
                messagesDiv.innerHTML = '';
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = 'message';
                    div.innerHTML = `<small>${new Date(data.time.toDate()).toLocaleTimeString()} - ${data.username}</small><br>${data.text}`;
                    messagesDiv.appendChild(div);
                });
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text || !currentUser) return;
            await addDoc(collection(db, 'messages'), {
                text,
                username: currentUser,
                time: new Date()
            });
            input.value = '';
        }

        // Global Leaderboard (by wins)
        function showLeaderboard() {
            const lb = document.getElementById('leaderboard');
            if (lb.style.display === 'none') {
                lb.style.display = 'block';
                if (leaderboardUnsub) leaderboardUnsub();
                const q = query(collection(db, 'users'), orderBy('wins', 'desc'), limit(10));
                leaderboardUnsub = onSnapshot(q, (snapshot) => {
                    const content = document.getElementById('lb-content');
                    content.innerHTML = '';
                    let rank = 1;
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'leaderboard-item';
                        item.innerHTML = `<span>#${rank} ${data.edition || 'Bedrock'} ${doc.id}</span><span>🏆${data.wins} | $${formatBalance(data.balance)}</span>`;
                        content.appendChild(item);
                        rank++;
                    });
                });
            } else {
                lb.style.display = 'none';
                if (leaderboardUnsub) leaderboardUnsub();
            }
        }

        function loadUsers(filter = '') {
            if (usersUnsub) usersUnsub();
            users = [];
            const usersRef = collection(db, 'users');
            const q = query(usersRef, limit(100));
            usersUnsub = onSnapshot(q, (snap) => {
                users = [];
                snap.docs.forEach((d) => {
                    const data = d.data();
                    const username = d.id;
                    if (filter === '' || username.toLowerCase().includes(filter.toLowerCase())) {
                        users.push({ username, edition: data.edition || 'Unknown', balance: data.balance || 0, wins: data.wins || 0 });
                    }
                });
                renderUsersTable();
            });
        }

        function renderUsersTable() {
            const tableDiv = document.getElementById('usersTable');
            if (users.length === 0) {
                tableDiv.innerHTML = '<p style="text-align: center; color: #ccc; padding: 20px;">No users found.</p>';
                return;
            }
            let html = '<table>';
            html += '<tr><th>Username</th><th>Edition</th><th>Balance</th><th>Wins</th></tr>';
            users.forEach(user => {
                html += `<tr><td>${user.username}</td><td>${user.edition}</td><td>$${formatBalance(user.balance)}</td><td>${user.wins}</td></tr>`;
            });
            html += '</table>';
            tableDiv.innerHTML = html;
        }

        async function doDeposit() {
            const user = document.getElementById('selectedUser').value.trim();
            const amtStr = document.getElementById('adjustAmount').value;
            const amt = parseBet(amtStr);
            if (!user || isNaN(amt) || amt <= 0) {
                showNotification('Invalid input! ⚠️', 'error');
                return;
            }
            const userRef = doc(db, 'users', user);
            const userSnap = await getDoc(userRef);
            if (!userSnap.exists()) {
                await setDoc(userRef, { balance: amt, wins: 0, edition: 'Bedrock' });
                showNotification(`Created & Deposited $${formatBalance(amt)} to ${user} 💳`, 'success');
            } else {
                const currentBal = userSnap.data().balance || 0;
                const newBal = currentBal + amt;
                await updateDoc(userRef, { balance: newBal });
                showNotification(`Deposited $${formatBalance(amt)} to ${user}. New: $${formatBalance(newBal)} 💳`, 'success');
            }
            document.getElementById('selectedUser').value = '';
            document.getElementById('adjustAmount').value = '';
            loadUsers(document.getElementById('userSearch').value);
        }

        async function doWithdraw() {
            const user = document.getElementById('selectedUser').value.trim();
            const amtStr = document.getElementById('adjustAmount').value;
            const amt = parseBet(amtStr);
            if (!user || isNaN(amt) || amt <= 0) {
                showNotification('Invalid input! ⚠️', 'error');
                return;
            }
            const userRef = doc(db, 'users', user);
            const userSnap = await getDoc(userRef);
            if (!userSnap.exists()) {
                showNotification('User not found! ⚠️', 'error');
                return;
            }
            const currentBal = userSnap.data().balance || 0;
            if (amt > currentBal) {
                showNotification(`Insufficient balance for ${user}! Current: $${formatBalance(currentBal)} 🏦`, 'error');
                return;
            }
            const newBal = currentBal - amt;
            await updateDoc(userRef, { balance: newBal });
            showNotification(`Withdrew $${formatBalance(amt)} from ${user}. New: $${formatBalance(newBal)} 🏦`, 'success');
            document.getElementById('selectedUser').value = '';
            document.getElementById('adjustAmount').value = '';
            loadUsers(document.getElementById('userSearch').value);
        }

        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('visible');
                s.classList.add('hidden');
            });
            const target = document.getElementById(`${screen}-screen`) || document.getElementById(screen);
            if (target) {
                target.classList.remove('hidden');
                target.classList.add('visible');
                currentScreen = screen;
                if (screen !== 'login') {
                    updateAllBalances();
                    if (screen === 'dashboard') loadMessages();
                }
                if (screen === 'admin') {
                    loadUsers('');
                }
                if (screen === 'mines') {
                    resetMines();
                }
                if (screen === 'towers') {
                    resetTowers();
                }
                if (screen === 'blackjack') {
                    resetBlackjack();
                }
                if (screen === 'crash') {
                    resetCrash();
                    if (!globalBettingActive && !globalCrashActive) {
                        startBettingPhase();
                    }
                }
            }
        }

        function setMode(mode) {
            if (mode === 'signup') {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('signup-form').style.display = 'block';
            } else {
                document.getElementById('signup-form').style.display = 'none';
                document.getElementById('login-form').style.display = 'block';
            }
        }

        async function signUp() {
            try {
                const username = document.getElementById('signup-username').value.trim();
                const edition = document.getElementById('signup-edition').value;
                const password = document.getElementById('signup-password').value;
                const confirm = document.getElementById('confirm-password').value;
                if (!username || !edition || !password || !confirm || password !== confirm) {
                    showNotification('Please fill all fields and ensure passwords match! ⚠️', 'error');
                    return;
                }
                if (username === ADMIN_USERNAME) {
                    showNotification('Admin username cannot be registered! Use login. ⚠️', 'error');
                    return;
                }
                const userRef = doc(db, 'users', username);
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) {
                    showNotification('User already exists! Please login instead. ⚠️', 'error');
                } else {
                    await setDoc(userRef, {
                        balance: 0,
                        wins: 0,
                        edition: edition,
                        password: password  // Note: Storing plain text passwords is insecure; consider hashing in production
                    });
                    showNotification('Sign up successful! Logging in... 🎉', 'success');
                    currentUser = username;
                    currentEdition = edition;
                    document.getElementById('user').textContent = currentUser;
                    document.getElementById('ed').textContent = currentEdition;
                    loadUserData();
                    loadMessages();
                    showScreen(isAdmin ? 'admin' : 'dashboard');
                    document.body.classList.add('logged-in');
                }
            } catch (error) {
                console.error('Sign up error:', error);
                showNotification('Failed to sign up! ⚠️', 'error');
            }
        }

        async function login() {
            try {
                const username = document.getElementById('username').value.trim();
                const edition = document.getElementById('edition').value;
                const password = document.getElementById('login-password').value;
                if (!username || !edition || !password) {
                    showNotification('Please fill all fields! ⚠️', 'error');
                    return;
                }
                const userRef = doc(db, 'users', username);
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) {
                    const data = userSnap.data();
                    if (data.password === password && (data.edition === edition || !data.edition)) {
                        currentUser = username;
                        currentEdition = edition;
                        document.getElementById('user').textContent = currentUser;
                        document.getElementById('ed').textContent = currentEdition;
                        loadUserData();
                        loadMessages();
                        showScreen(isAdmin ? 'admin' : 'dashboard');
                        document.body.classList.add('logged-in');
                        showNotification('Login successful! Welcome back 🎉', 'success');
                        if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                            isAdmin = true;
                            showScreen('admin');
                        }
                    } else {
                        showNotification('Invalid password or edition! ⚠️', 'error');
                    }
                } else {
                    showNotification('User not found! Please sign up. ⚠️', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Failed to login! ⚠️', 'error');
            }
        }

        function logout() {
            currentUser = '';
            currentEdition = '';
            balance = 0;
            wins = 0;
            isAdmin = false;
            if (userUnsub) userUnsub();
            if (messagesUnsub) messagesUnsub();
            if (leaderboardUnsub) leaderboardUnsub();
            if (usersUnsub) usersUnsub();
            document.body.classList.remove('logged-in');
            showScreen('login');
            showNotification('Logged out successfully! 👋', 'success');
        }

        function deposit() {
            const amtStr = prompt('Enter deposit amount (e.g., 100 or 1k):');
            const amt = parseBet(amtStr);
            if (isNaN(amt) || amt <= 0) return showNotification('Invalid amount! ⚠️', 'error');
            updateUserBalance(balance + amt);
            showNotification(`Deposited $${formatBalance(amt)} 💳`, 'success');
        }

        function withdraw() {
            const amtStr = prompt('Enter withdraw amount (e.g., 100 or 1k):');
            const amt = parseBet(amtStr);
            if (isNaN(amt) || amt <= 0 || amt > balance) return showNotification('Invalid or insufficient amount! ⚠️', 'error');
            updateUserBalance(balance - amt);
            showNotification(`Withdrew $${formatBalance(amt)} 🏦`, 'success');
        }

        function showComingSoon() {
            showNotification('This game is coming soon! ⏳', 'info');
        }

        function showNotification(message, type = 'info') {
            const notif = document.getElementById('notification');
            notif.innerHTML = message;
            notif.className = 'notification ' + type;
            notif.style.display = 'block';
            setTimeout(() => { notif.style.display = 'none'; }, 3000);
        }

        function downloadLog() {
            // Dummy function; implement logging if needed
            showNotification('Log download not implemented yet! 📥', 'info');
        }

        // Game Functions (Mines, Dice, Towers, Blackjack, Crash)
        // These are local state but update server balance on win/loss

        function resetMines() {
            gameActive = false;
            minesGrid = [];
            minesRevealed = 0;
            document.getElementById('mine-grid').innerHTML = '';
            document.getElementById('mines-result').innerHTML = '';
            document.getElementById('cashout-btn').style.display = 'none';
        }

        function startMines() {
            if (gameActive) return;
            minesBet = parseBet(document.getElementById('minesbet').value);
            minesNum = parseInt(document.getElementById('minesnum').value);
            if (minesBet <= 0 || minesBet > balance) return showNotification('Invalid bet! ⚠️', 'error');
            updateUserBalance(balance - minesBet);
            gameActive = true;
            minesGrid = Array(25).fill('diamond').fill('bomb', 0, minesNum);
            minesGrid = minesGrid.sort(() => Math.random() - 0.5);
            const grid = document.getElementById('mine-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'mine-cell';
                cell.onclick = () => revealMine(i);
                grid.appendChild(cell);
            }
            document.getElementById('mines-result').innerHTML = '';
            document.getElementById('cashout-btn').style.display = 'block';
        }

        function revealMine(index) {
            if (!gameActive) return;
            const cell = document.getElementById('mine-grid').children[index];
            if (cell.classList.contains('revealed')) return;
            cell.classList.add('revealed');
            if (minesGrid[index] === 'bomb') {
                cell.textContent = '💣';
                cell.classList.add('boom');
                showNotification('Boom! You lost. 💥', 'error');
                gameActive = false;
                disableMinesGrid();
            } else {
                cell.textContent = '💎';
                minesRevealed++;
                if (minesRevealed === 25 - minesNum) {
                    const payout = minesBet * (25 / (25 - minesNum));
                    updateUserBalance(balance + payout, true);
                    showNotification(`You won $${formatBalance(payout)}! 🎉`, 'success');
                    gameActive = false;
                }
            }
        }

        function cashOutMines() {
            if (!gameActive) return;
            const multiplier = getMinesMultiplier(minesRevealed, minesNum);
            const payout = minesBet * multiplier;
            updateUserBalance(balance + payout, true);
            showNotification(`Cashed out $${formatBalance(payout)} at ${multiplier}x! 💰`, 'success');
            gameActive = false;
            disableMinesGrid();
        }

        function getMinesMultiplier(revealed, numMines) {
            // Simple multiplier calculation
            return (25 / (25 - numMines)) * (revealed / (25 - numMines));
        }

        function disableMinesGrid() {
            Array.from(document.getElementById('mine-grid').children).forEach(cell => {
                cell.classList.add('disabled');
            });
            document.getElementById('cashout-btn').style.display = 'none';
        }

        function playDice() {
            diceBet = parseBet(document.getElementById('dicebet').value);
            if (diceBet <= 0 || diceBet > balance) return showNotification('Invalid bet! ⚠️', 'error');
            updateUserBalance(balance - diceBet);
            const choice = document.getElementById('dicechoice').value;
            const die1 = Math.floor(Math.random() * 6) + 1;
            const die2 = Math.floor(Math.random() * 6) + 1;
            const total = die1 + die2;
            document.getElementById('dice-display').textContent = `🎲 ${die1} + ${die2} = ${total}`;
            let win = false;
            if (choice === 'over' && total > 7) win = true;
            if (choice === 'under' && total < 7) win = true;
            if (win) {
                const payout = diceBet * 2;
                updateUserBalance(balance + payout, true);
                document.getElementById('dice-result').textContent = `You win $${formatBalance(payout)}! 🎉`;
            } else if (total === 7) {
                updateUserBalance(balance + diceBet);
                document.getElementById('dice-result').textContent = 'Push (tie). Bet returned.';
            } else {
                document.getElementById('dice-result').textContent = 'You lose. 😞';
            }
        }

        function resetTowers() {
            towersGameActive = false;
            towersGrid = [];
            currentTowerRow = 0;
            towersRevealed = 0;
            document.getElementById('towers-display').innerHTML = '';
            document.getElementById('towers-result').innerHTML = '';
            document.getElementById('cashout-btn-towers').style.display = 'none';
        }

        function startTowers() {
            if (towersGameActive) return;
            towersBet = parseBet(document.getElementById('towersbet').value);
            if (towersBet <= 0 || towersBet > balance) return showNotification('Invalid bet! ⚠️', 'error');
            updateUserBalance(balance - towersBet);
            towersGameActive = true;
            towersGrid = Array.from({length: 10}, () => {
                const row = Array(3).fill('safe');
                row[Math.floor(Math.random() * 3)] = 'skull';
                return row;
            });
            const display = document.getElementById('towers-display');
            display.innerHTML = '';
            for (let i = 9; i >= 0; i--) {
                const row = document.createElement('div');
                row.className = 'tower-row';
                for (let j = 0; j  < 3; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'tower-cell';
                    cell.onclick = () => revealTower(i, j);
                    row.appendChild(cell);
                }
                display.appendChild(row);
            }
            document.getElementById('towers-result').innerHTML = '';
            document.getElementById('cashout-btn-towers').style.display = 'block';
            enableTowerRow(9);
        }

        function enableTowerRow(rowIndex) {
            const rows = document.getElementById('towers-display').children;
            Array.from(rows).forEach((row, i) => {
                Array.from(row.children).forEach(cell => {
                    cell.style.pointerEvents = (9 - i === rowIndex) ? 'auto' : 'none';
                });
            });
        }

        function revealTower(row, col) {
            if (!towersGameActive || row !== 9 - currentTowerRow) return;
            const rows = document.getElementById('towers-display').children;
            const cell = rows[currentTowerRow].children[col];
            cell.classList.add('revealed');
            if (towersGrid[9 - row][col] === 'skull') {
                cell.textContent = '💀';
                cell.classList.add('skull');
                showNotification('Hit a skull! You lost. 💥', 'error');
                towersGameActive = false;
                document.getElementById('cashout-btn-towers').style.display = 'none';
            } else {
                cell.textContent = '✅';
                cell.classList.add('safe');
                currentTowerRow++;
                towersRevealed++;
                if (currentTowerRow === 10) {
                    const payout = towersBet * 10; // Example payout
                    updateUserBalance(balance + payout, true);
                    showNotification(`Cleared the tower! Won $${formatBalance(payout)} 🎉`, 'success');
                    towersGameActive = false;
                    document.getElementById('cashout-btn-towers').style.display = 'none';
                } else {
                    enableTowerRow(9 - currentTowerRow);
                }
            }
        }

        function cashOutTowers() {
            if (!towersGameActive) return;
            const multiplier = currentTowerRow + 1; // Example
            const payout = towersBet * multiplier;
            updateUserBalance(balance + payout, true);
            showNotification(`Cashed out $${formatBalance(payout)} at level ${currentTowerRow + 1}! 💰`, 'success');
            towersGameActive = false;
            document.getElementById('cashout-btn-towers').style.display = 'none';
        }

        function resetBlackjack() {
            playerHand = [];
            dealerHand = [];
            bjBet = 0;
            document.getElementById('bj-hand-player').innerHTML = '';
            document.getElementById('bj-hand-dealer').innerHTML = '';
            document.getElementById('bj-result').innerHTML = '';
        }

        function playBlackjack() {
            bjBet = parseBet(document.getElementById('bet').value);
            if (bjBet <= 0 || bjBet > balance) return showNotification('Invalid bet! ⚠️', 'error');
            updateUserBalance(balance - bjBet);
            playerHand = [drawCard(), drawCard()];
            dealerHand = [drawCard(), drawCard()];
            renderHands();
            if (getHandValue(playerHand) === 21) {
                const payout = bjBet * 2.5;
                updateUserBalance(balance + payout, true);
                document.getElementById('bj-result').textContent = 'Blackjack! You win. 🎉';
            }
        }

        function bjHit() {
            playerHand.push(drawCard());
            renderHands();
            if (getHandValue(playerHand) > 21) {
                document.getElementById('bj-result').textContent = 'Bust! You lose. 😞';
            }
        }

        function bjStand() {
            while (getHandValue(dealerHand) < 17) {
                dealerHand.push(drawCard());
            }
            renderHands(true);
            const playerValue = getHandValue(playerHand);
            const dealerValue = getHandValue(dealerHand);
            if (playerValue > 21) {
                document.getElementById('bj-result').textContent = 'You bust! Lose. 😞';
            } else if (dealerValue > 21 || playerValue > dealerValue) {
                const payout = bjBet * 2;
                updateUserBalance(balance + payout, true);
                document.getElementById('bj-result').textContent = 'You win! 🎉';
            } else if (playerValue === dealerValue) {
                updateUserBalance(balance + bjBet);
                document.getElementById('bj-result').textContent = 'Push (tie).';
            } else {
                document.getElementById('bj-result').textContent = 'Dealer wins. 😞';
            }
        }

        function drawCard() {
            const suits = ['♥', '♦', '♣', '♠'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            return values[Math.floor(Math.random() * values.length)] + suits[Math.floor(Math.random() * suits.length)];
        }

        function getHandValue(hand) {
            let value = 0;
            let aces = 0;
            hand.forEach(card => {
                const v = card.slice(0, -1);
                if (v === 'A') aces++;
                else value += isNaN(v) ? 10 : parseInt(v);
            });
            for (let i = 0; i < aces; i++) {
                value += (value + 11 <= 21) ? 11 : 1;
            }
            return value;
        }

        function renderHands(showDealer = false) {
            const playerDiv = document.getElementById('bj-hand-player');
            playerDiv.innerHTML = '';
            playerHand.forEach(card => {
                const c = document.createElement('div');
                c.className = 'card';
                c.textContent = card;
                playerDiv.appendChild(c);
            });
            const dealerDiv = document.getElementById('bj-hand-dealer');
            dealerDiv.innerHTML = '';
            dealerHand.forEach((card, i) => {
                const c = document.createElement('div');
                c.className = 'card';
                c.textContent = (showDealer || i > 0) ? card : '?';
                dealerDiv.appendChild(c);
            });
        }

        function resetCrash() {
            userCrashBet = 0;
            userCashedOut = false;
            document.getElementById('crash-input').style.display = 'flex';
            document.getElementById('crash-area').style.display = 'none';
            document.getElementById('cashout-btn-crash').style.display = 'none';
            document.getElementById('crash-result').innerHTML = '';
        }

        function startBettingPhase() {
            globalBettingActive = true;
            globalCrashActive = false;
            document.getElementById('crash-input').style.display = 'flex';
            document.getElementById('crash-area').style.display = 'block';
            document.getElementById('multiplier').textContent = '1.00x';
            document.getElementById('rocket').style.transform = 'translateX(-50%)';
            countdown(10, () => launchRocket());
        }

        function countdown(seconds, callback) {
            document.getElementById('countdown').textContent = `Launch in ${seconds}s`;
            const interval = setInterval(() => {
                seconds--;
                document.getElementById('countdown').textContent = `Launch in ${seconds}s`;
                if (seconds <= 0) {
                    clearInterval(interval);
                    document.getElementById('countdown').textContent = '';
                    callback();
                }
            }, 1000);
        }

        function betOnCrash() {
            userCrashBet = parseBet(document.getElementById('crashbet').value);
            if (userCrashBet <= 0 || userCrashBet > balance || !globalBettingActive) return showNotification('Invalid bet or betting closed! ⚠️', 'error');
            updateUserBalance(balance - userCrashBet);
            showNotification(`Bet placed: $${formatBalance(userCrashBet)} 🚀`, 'success');
            document.getElementById('crash-input').style.display = 'none';
            document.getElementById('cashout-btn-crash').style.display = 'block';
        }

        function launchRocket() {
            globalBettingActive = false;
            globalCrashActive = true;
            globalCurrentMultiplier = 1.00;
            globalCrashMultiplier = Math.random() * 10 + 1.1; // Random crash point
            const interval = setInterval(() => {
                globalCurrentMultiplier += 0.01;
                document.getElementById('multiplier').textContent = `${globalCurrentMultiplier.toFixed(2)}x`;
                document.getElementById('rocket').style.bottom = `${globalCurrentMultiplier * 10}px`;
                if (globalCurrentMultiplier >= globalCrashMultiplier) {
                    clearInterval(interval);
                    showNotification('Crash! 💥', 'error');
                    if (!userCashedOut && userCrashBet > 0) {
                        document.getElementById('crash-result').textContent = 'You lost your bet.';
                    }
                    globalCrashActive = false;
                    setTimeout(startBettingPhase, 5000);
                }
            }, 100);
        }

        function cashOutCrash() {
            if (!globalCrashActive || userCashedOut || userCrashBet <= 0) return;
            userCashedOut = true;
            const payout = userCrashBet * globalCurrentMultiplier;
            updateUserBalance(balance + payout, true);
            showNotification(`Cashed out $${formatBalance(payout)} at ${globalCurrentMultiplier.toFixed(2)}x! 💰`, 'success');
            document.getElementById('cashout-btn-crash').style.display = 'none';
            document.getElementById('crash-result').textContent = 'Waiting for next round...';
        }

        // Initial setup
        setMode('login');
    </script>
</body>
</html>
